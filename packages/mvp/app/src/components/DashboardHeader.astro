---
import type { CSSProperty } from "astro/types"

type Props = {
  class?: string;
  style?: string | Record<CSSProperty, string>;
};

type PageLink = {
  text: string;
  href: string;
  current: boolean;
};

const applyCurrentProp = (page: Omit<PageLink, "current">): PageLink => ({
  current: Astro.url.pathname.startsWith(page.href),
  ...page,
});

const pages = Array.from(
  [
    { text: "Home", href: "/home" },
    { text: "Tasks", href: "/tasks" },
    { text: "Accounts", href: "/accounts" },
  ],
  applyCurrentProp,
);
---

<header class={Astro.props.class} style={Astro.props.style}>
  <nav>
    <ul>
      <li><strong><a href="/">CRM</a></strong></li>
    </ul>
    <ul>
      {Astro.locals.user ? (
        <>
          {pages.map(page => (
            <li>
              <a
                aria-current={page.current}
                href={page.href}
              >{page.text}</a>
            </li>
          ))}
        </>
        <li>
          <form method="post" action="/api/v0/auth/logout">
            <input type="submit" value="Logout" class="secondary" />
          </form>
        </li>
      ) : (
        <li><a role="button" href="/login">Login</a></li>
      )}
    </ul>
  </nav>
</header>
