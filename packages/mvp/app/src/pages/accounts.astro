---
import { Account, db, eq } from "astro:db";
import Layout from "@/layouts/MainLayout.astro";

const { user } = Astro.locals;

if (!user)
  return Astro.redirect("/login");

const accountsPromise = user.primary_org && db.select()
  .from(Account)
  .where(eq(Account.org, user.primary_org));
---

<Layout
  meta={{
    title: "Accounts",
    description: "Organization accounts",
  }}
>
  <div class="pico container">
  <h1>Accounts</h1>
    {
      accountsPromise && (
        accountsPromise.then(accounts => accounts.map(account => (
          <section class="mx-auto">
            <h2>{account.name}</h2>
          </section>
        )))
      )
    }
  </div>
</Layout>
