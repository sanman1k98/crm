---
import type { EmailInfo } from '@/lib/shared';
import Layout from '@/layouts/MainLayout.astro';
import { getOrgContacts } from '@/lib/orgs';

const { user } = Astro.locals;

if (!user)
  return Astro.redirect('/login');

const contacts = await getOrgContacts();
---

<Layout
	meta={{
		title: 'Contacts',
		description: 'All contacts',
	}}
	class="mx-auto container pico"
>
	<table>
		<thead>
			<tr>
				<th scope="col">ID</th>
				<th scope="col">First name</th>
				<th scope="col">Last name</th>
				<th scope="col">Emails</th>
				<th scope="col">Note</th>
			</tr>
		</thead>
		<tbody>
			{
				contacts.map((c) => (
					<tr>
						<th>{c.id}</th>
						<td>{c.firstName}</td>
						<td>{c.lastName}</td>
						<td>{(c.emails as EmailInfo[]).map((e) => e.email).join(', ')}</td>
						<td>{c.note}</td>
					</tr>
				))
			}
		</tbody>
	</table>
</Layout>
