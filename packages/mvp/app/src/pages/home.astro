---
import { db, Task, eq } from "astro:db";
import Layout from "@/layouts/MainLayout.astro";

if (!Astro.locals.user)
  return Astro.redirect("/login");

const { username } = Astro.locals.user;
const greeting = `Welcome back ${username}`;

const tasks = await db.select()
  .from(Task)
  .where(eq(Task.created_by, Astro.locals.user.id));
---

<Layout
  meta={{
    title: "Home",
    description: greeting,
  }}
  class="mx-auto"
>
  <h1 class="font-bold text-center text-4xl sm:text-5xl md:text-6xl lg:text-7xl">
    {greeting}
  </h1>
  <div class="pico">
    {
      tasks.map(t => (
        <article>
          <header>#{t.number} {t.title}</header>
          {t.body}
        </article>
      ))
    }
  </div>
</Layout>
