---
import Layout from "@/layouts/MainLayout.astro";
import { getOpportunityInfo } from "@/lib/opportunities";
import { getUserInfo } from "@/lib/users";

const { user } = Astro.locals;

if (!user)
  return Astro.redirect("/login");

const id = Number.parseInt(Astro.params.id!, 10);

const opportunity = Number.isInteger(id)
  ? await getOpportunityInfo(id)
  : null;

if (!opportunity)
  return new Response(null, { status: 404 });

const author = await getUserInfo(opportunity.author);
---

<Layout
  meta={{
    title: opportunity.name,
    description: opportunity.name,
  }}
>
  <div class="container">
    <h1>{opportunity.name}</h1>
    <ul>
      <li>
        <strong>Stage:</strong>
        {opportunity.stage}
      </li>
      <li>
        <strong>Amount:</strong>
        {opportunity.amount.toLocaleString(undefined, { style: "currency", currency: "USD" })}
      </li>
      <li>
        <strong>Author:</strong>
        {author!.fullname}
      </li>
    </ul>
  </div>
</Layout>

