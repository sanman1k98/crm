---
import { Task, db, eq } from "astro:db";
import Layout from "@/layouts/MainLayout.astro";

const { user } = Astro.locals;

if (!user)
  return Astro.redirect("/login");

const tasksPromise = db.select()
  .from(Task)
  .where(eq(Task.author, user.id));
---

<Layout
  meta={{
    title: "Tasks",
    description: "My tasks",
  }}
>
  <div class="pico container">
    <h1>My tasks</h1>
    {
      tasksPromise.then(tasks => tasks.map(t => (
        <article class="mx-auto max-w-sm">
          {t.title}
          {t.body && <footer>{t.body}</footer>}
        </article>
      )))
    }
  </div>
</Layout>
